"use strict";exports.id=678,exports.ids=[678],exports.modules={3519:(e,t,r)=>{r.d(t,{Z:()=>c});var i=r(1185),o=r.n(i);let a=new(o()).Schema({url:{type:String,required:!0,unique:!0},currency:{type:String,required:!0},image:{type:String,required:!0},title:{type:String,required:!0},currentPrice:{type:Number,required:!0},originalPrice:{type:Number,required:!0},priceHistory:[{price:{type:Number,required:!0},date:{type:Date,default:Date.now}}],lowestPrice:{type:Number},highestPrice:{type:Number},averagePrice:{type:Number},discountRate:{type:Number},description:{type:String},category:{type:String},reviewsCount:{type:Number},isOutOfStock:{type:Boolean,default:!1},users:[{email:{type:String,required:!0}}],default:[]},{timestamps:!0}),n=o().models.Product||o().model("Product",a),c=n},8291:(e,t,r)=>{r.d(t,{P:()=>n});var i=r(1185),o=r.n(i);let a=!1,n=async()=>{if(o().set("strictQuery",!0),!process.env.MONGODB_URI)return console.log("MONGODB_URI is not defined");if(a)return console.log("=> using existing database connection");try{await o().connect(process.env.MONGODB_URI),a=!0,console.log("MongoDB Connected")}catch(e){console.log(e)}}},5103:(e,t,r)=>{r.r(t),r.d(t,{generateEmailBody:()=>c,sendEmail:()=>s});var i=r(459),o=r(3330),a=r(1419);let n={WELCOME:"WELCOME",CHANGE_OF_STOCK:"CHANGE_OF_STOCK",LOWEST_PRICE:"LOWEST_PRICE",THRESHOLD_MET:"THRESHOLD_MET"};async function c(e,t){let r=e.title.length>20?`${e.title.substring(0,20)}...`:e.title,i="",o="";switch(t){case n.WELCOME:i=`Welcome to Product price Tracking for ${r}`,o=`
        <div>
          <h2>Welcome to Product Explorer ðŸš€</h2>
          <p>You are now tracking ${e.title}.</p>
          <p>Here's an example of how you'll receive updates:</p>
          <div style="border: 1px solid #ccc; padding: 10px; background-color: #f8f8f8;">
            <h3>${e.title} is back in stock!</h3>
            <p>We're excited to let you know that ${e.title} is now back in stock.</p>
            <p>Don't miss out - <a href="${e.url}" target="_blank" rel="noopener noreferrer">buy it now</a>!</p>
            <img src="https://i.ibb.co/pwFBRMC/Screenshot-2023-09-26-at-1-47-50-AM.png" alt="Product Image" style="max-width: 100%;" />
          </div>
          <p>Stay tuned for more updates on ${e.title} and other products you're tracking.</p>
        </div>
      `;break;case n.CHANGE_OF_STOCK:i=`${r} is now back in stock!`,o=`
        <div>
          <h4>Hey, ${e.title} is now restocked! Grab yours before they run out again!</h4>
          <p>See the product <a href="${e.url}" target="_blank" rel="noopener noreferrer">here</a>.</p>
        </div>
      `;break;case n.LOWEST_PRICE:i=`Lowest Price Alert for ${r}`,o=`
        <div>
          <h4>Hey, ${e.title} has reached its lowest price ever!!</h4>
          <p>Grab the product <a href="${e.url}" target="_blank" rel="noopener noreferrer">here</a> now.</p>
        </div>
      `;break;case n.THRESHOLD_MET:i=`Discount Alert for ${r}`,o=`
        <div>
          <h4>Hey, ${e.title} is now available at a discount more than 40%!</h4>
          <p>Grab it right away from <a href="${e.url}" target="_blank" rel="noopener noreferrer">here</a>.</p>
        </div>
      `;break;default:throw Error("Invalid notification type.")}return{subject:i,body:o}}let l=o.createTransport({pool:!0,service:"hotmail",port:2525,auth:{user:"kunalmarmat2002@outlook.com",pass:process.env.EMAIL_PASSWORD},maxConnections:1}),s=async(e,t)=>{let r={from:"kunalmarmat2002@outlook.com",to:t,html:e.body,subject:e.subject};l.sendMail(r,(e,t)=>{if(e)return console.log(e);console.log("Email sent: ",t)})};(0,a.h)([c,s]),(0,i.U)("90e755164d232ade5a3eca71e8d8c7cdcfdac080",null,c),(0,i.U)("64dfae728ca8829c4bf53b2e2a7a74a3aa758505",null,s)},934:(e,t,r)=>{r.r(t),r.d(t,{scrapeAmazonProduct:()=>c});var i=r(459),o=r(1779),a=r(2781),n=r(1538);async function c(e){if(!e)return;let t=String(process.env.BRIGHT_DATA_USERNAME),r=String(process.env.BRIGHT_DATA_PASSWORD),i={auth:{username:`${t}-session-${1e6*Math.random()|0}`,password:r},host:"brd.superproxy.io",port:22225,rejectUnauthorized:!1};try{let t=await o.Z.get(e,i),r=a.zD(t.data),c=r("#productTitle").text().trim(),l=(0,n.EL)(r(".priceToPay span.a-price-whole"),r(".a.size.base.a-color-price"),r(".a-button-selected .a-color-base")),s=(0,n.EL)(r("#priceblock_ourprice"),r(".a-price.a-text-price span.a-offscreen"),r("#listPrice"),r("#priceblock_dealprice"),r(".a-size-base.a-color-price")),u="currently unavailable"===r("#availability span").text().trim().toLowerCase(),p=r("#imgBlkFront").attr("data-a-dynamic-image")||r("#landingImage").attr("data-a-dynamic-image")||"{}",d=Object.keys(JSON.parse(p)),m=(0,n.Eq)(r(".a-price-symbol")),g=r(".savingsPercentage").text().replace(/[-%]/g,""),b=(0,n.B0)(r),f={url:e,currency:m||"$",image:d[0],title:c,currentPrice:Number(l)||Number(s),originalPrice:Number(s)||Number(l),priceHistory:[],discountRate:Number(g),category:"category",reviewsCount:100,stars:4.5,isOutOfStock:u,description:b,lowestPrice:Number(l)||Number(s),highestPrice:Number(s)||Number(l),averagePrice:Number(l)||Number(s)};return f}catch(e){console.log(e)}}(0,r(1419).h)([c]),(0,i.U)("90d3d88f69aee2656cbc868b6a72796fcd30adfb",null,c)},1538:(e,t,r)=>{r.d(t,{B0:()=>n,EL:()=>o,Eq:()=>a,TF:()=>c,Ux:()=>u,bd:()=>s,nd:()=>l,uf:()=>p});let i={CHANGE_OF_STOCK:"CHANGE_OF_STOCK",LOWEST_PRICE:"LOWEST_PRICE",THRESHOLD_MET:"THRESHOLD_MET"};function o(...e){for(let t of e){let e=t.text().trim();if(e){let t;let r=e.replace(/[^\d.]/g,"");return r&&(t=r.match(/\d+\.\d{2}/)?.[0]),t||r}}return""}function a(e){let t=e.text().trim().slice(0,1);return t||""}function n(e){for(let t of[".a-unordered-list .a-list-item",".a-expander-content p"]){let r=e(t);if(r.length>0){let t=r.map((t,r)=>e(r).text().trim()).get().join("\n");return t}}return""}function c(e){let t=e[0];for(let r=0;r<e.length;r++)e[r].price>t.price&&(t=e[r]);return t.price}function l(e){let t=e[0];for(let r=0;r<e.length;r++)e[r].price<t.price&&(t=e[r]);return t.price}function s(e){let t=e.reduce((e,t)=>e+t.price,0),r=t/e.length||0;return r}let u=(e,t)=>{let r=l(t.priceHistory);return e.currentPrice<r?i.LOWEST_PRICE:!e.isOutOfStock&&t.isOutOfStock?i.CHANGE_OF_STOCK:e.discountRate>=40?i.THRESHOLD_MET:null},p=(e=0)=>e.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})}};