"use strict";(()=>{var e={};e.id=557,e.ids=[557],e.modules={1185:e=>{e.exports=require("mongoose")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9491:e=>{e.exports=require("assert")},2081:e=>{e.exports=require("child_process")},6113:e=>{e.exports=require("crypto")},9523:e=>{e.exports=require("dns")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},2037:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},5477:e=>{e.exports=require("punycode")},9955:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},6224:e=>{e.exports=require("tty")},7310:e=>{e.exports=require("url")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},1312:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>w,originalPathname:()=>E,requestAsyncStorage:()=>y,routeModule:()=>g,serverHooks:()=>f,staticGenerationAsyncStorage:()=>P,staticGenerationBailout:()=>v});var i={};t.r(i),t.d(i,{GET:()=>q,dynamic:()=>x,maxDuration:()=>d,revalidate:()=>m}),t(5655);var o=t(3323),a=t(4647),s=t(6886),u=t(1538),p=t(8291),n=t(3519),c=t(934),l=t(5103);let d=300,x="force-dynamic",m=0;async function q(e){try{(0,p.P)();let e=await n.Z.find({});if(!e)throw Error("No product fetched");let r=await Promise.all(e.map(async e=>{let r=await (0,c.scrapeAmazonProduct)(e.url);if(!r)return;let t=[...e.priceHistory,{price:r.currentPrice}],i={...r,priceHistory:t,lowestPrice:(0,u.nd)(t),highestPrice:(0,u.TF)(t),averagePrice:(0,u.bd)(t)},o=await n.Z.findOneAndUpdate({url:i.url},i),a=(0,u.Ux)(r,e);if(a&&o.users.length>0){let e={title:o.title,url:o.url},r=await (0,l.generateEmailBody)(e,a),t=o.users.map(e=>e.email);await (0,l.sendEmail)(r,t)}return o}));return s.Z.json({message:"Ok",data:r})}catch(e){throw Error(`Failed to get all products: ${e.message}`)}}let h=o.AppRouteRouteModule,g=new h({definition:{kind:a.x.APP_ROUTE,page:"/api/cron/route",pathname:"/api/cron",filename:"route",bundlePath:"app/api/cron/route"},resolvedPagePath:"E:\\My projects\\Aspirenex_Ecommerce_scrape_web\\client\\app\\api\\cron\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:y,staticGenerationAsyncStorage:P,serverHooks:f,headerHooks:w,staticGenerationBailout:v}=g,E="/api/cron/route"}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[966,727,886,678],()=>t(1312));module.exports=i})();